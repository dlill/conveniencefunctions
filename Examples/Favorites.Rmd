---
title: "My favorite R-functions"
author: "Daniel Lill"
date: "13 October 2017"
output: html_document
---


Dies sind meine Lieblings-Packages und -Funktionen in R


# Install and load Packages
```{r, eval=FALSE}
devtools::install_github("dlill/conveniencefunctions")
install.packages("tidyverse") # hat viele sub-packages, die das Arbeiten mit data.frames schöner macht. 
install.packages("magrittr")  # der Pipe-Operator
install.packages("plotly")    # interaktive plots
```


```{r}
library(conveniencefunctions)
library(plotly)
library(tidyverse)
library(magrittr)
```


# convenience-functions
```{r}
mylist <- list(a = diamonds, b =1:10)
attr(mylist, "myattr") <- "myattribute"

mylist
str0(mylist)
str1(mylist)
str2(mylist)
```


# tidyverse
## dplyr
Das package dplyr bietet eine schöne Syntax, um mit data.frames zu arbeiten.
Observations (rows) zu filtern geht z.B. mit filter(), variablen auszuwählen, geht mit select() und vieles mehr...
Die Variablennamen muss man nicht mehr als string übergeben.
Bsp: alle hochkarätigen diamanten unter 1500$, nach preis absteigend sortiert
```{r}
mydiamonds <- diamonds
mydiamonds <- filter(mydiamonds, carat >0.3)
mydiamonds <- filter(mydiamonds, price < 1500)
arrange(mydiamonds, desc(price))
```


# magrittr

Prepare to have your lives changed ;) Drückt mal Strg+Shift+M (und wenn ihr grad dabei seid, in nem code-feld Alt+-)

%>% übergibt den return value an die nächste Funktion und wertet diese dann direkt aus, mit dem return value als erstes Argument für die nächste Funktion.
```{r}
?"%>%"

```

Das Bsp von oben wird zu:

```{r}
diamonds %>% 
  filter(carat >0.3) %>% 
  filter(price < 1500) %>% 
  arrange(desc(price))
```

Cool wirds dadurch, dass man jetzt einfach Zeilen ein-und auskommentieren kann.
Damit kann man schnell explorativ arbeiten.
```{r}
diamonds %>% 
  filter(carat >0.3) %>% 
  # filter(price < 1500) %>% 
  arrange(desc(price))
```

Wenn man manchmal die letzte Zeile auskommentieren will ohne %>% in der vorherigen Zeile löschen zu müssen, kann man folgendes machen
```{r}
diamonds %>% 
  filter(carat >0.3) %>% 
  filter(price < 1500) %>% 
  # arrange(desc(price)) %>% 
  {.}
```
Das Äquivalent dazu in ggplot, wenn man irgendwelche Sachen zu dem plot noch hinzuaddieren will, ohne das "+" am Ende der letzten Zeile modifizieren zu wollen, ist geom_blank()


Man kann den return value auch als argument an anderer stelle benutzen. Das macht man dann, indem man einen Punkt dahin setzt, wo der vorherige return value eingesetzt werden soll. 
```{r}
5 %>% 
  is_greater_than(1:10, .)
```

Funktionen mit magrittr definieren (hab ich noch nie benutzt, ist aber im Prinzip auch sehr cool)
```{r}
myfun <- . %>% raise_to_power(2) %>% sum
myfun(1:5)
```

Viele coole sachen mehr gibts hier: https://www.r-bloggers.com/magrittr-1-5/



# Plotly
Achtung, ab dem moment, wo ggplot ins Spiel kommt, ist es nicht mehr %>%, sondern +

## statisch
Probiert mal, einzelne Zeilen nach Lust un Laune auszukommentieren
```{r}
diamonds %>% 
  filter(carat >0.3) %>% 
  # filter(price < 1500) %>% 
  filter(clarity %in% c("I1", "SI2", "SI1")) %>% 
  arrange(desc(price)) %>% 
  ggplot(aes(carat, price)) +
  geom_point(aes(color = clarity)) +
  stat_smooth(aes(color = clarity)) +
  dMod::theme_dMod()+
  geom_blank()
```


## Jetzt mit plotly:

* Klick auf die Legende
* mit der Maus über den Plot fahren
* Klick auf den Plot und ziehe horizontal/vertikal/diagonal
* über dem Plot gibts noch ein paar Funktionen, wie als png exportieren etc
```{r}
myplot <- diamonds %>% 
  filter(carat >0.3) %>% 
  filter(price < 1000) %>% 
  filter(clarity %in% c("I1", "SI2", "SI1")) %>%
  arrange(desc(price)) %>% 
  ggplot(aes(carat, price)) +
  geom_point(aes(color = clarity)) +
  stat_smooth(aes(color = clarity)) +
  dMod::theme_dMod()+
  geom_blank()
plotly::ggplotly(myplot) # macht aus nem ggplot ein plotly-objekt, muss noch rausfinden, wie man das gut pipen kann, klappt grad nicht
```


# aes(frame)
das aes "frame" gibt es nicht in ggplot, aber plotly kann damit was anfangen :)

jetzt ist "volume" in dem play-button. damit funktionieren die legenden aber noch nicht so super, vllt verbessern die das noch irgendwann :)

Man sieht, dass sowohl die karat-zahl als auch der Preis mit zunehmendem volume steigt
```{r}
myplot <- diamonds %>% 
  filter(carat >0.3) %>%
  filter(price < 500) %>%
  # filter(clarity %in% c("I1", "SI2", "SI1")) %>%
  # arrange(desc(price)) %>% 
  mutate(volume = round(x*y*z)) %>% # füge dem data.frame noch "volume" hinzu; die formel würde stimmen, wenn die diamanten rechteckig wären
  ggplot(aes(carat, price, frame = volume)) + # aes frame = volume
  geom_point(aes(color = clarity)) +
  # stat_smooth(aes(color = clarity)) +
  dMod::theme_dMod()+
  geom_blank()
plotly::ggplotly(myplot)
```

Bei mir ist es komischweise grad relativ langsam. Das ist eine potentielle Limitierung
```{r}
myplot <- gapminder::gapminder %>% 
  ggplot(aes(x = lifeExp, y = gdpPercap, frame = year, color = country)) +
  geom_point()
ggplotly(myplot)
```



